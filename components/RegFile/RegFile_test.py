import random

from pymtl import *
from pclib.test import run_test_vector_sim
from RegFile import RegFile

def gen_data( width, length ):
	upper = 2**(width-1)-1
	lower = -2**(width-1)-1
	test_data = [None] * length
	for i in xrange( length ):
		if i != 0:
			test_data[i] = Bits(width, random.randint(lower,upper))
		else:
			test_data[i] = Bits(width, 0);
	return test_data


def gen_vector_table( data ):
	test_vector_table = [('rX_address rX* rY_address rY* rZ_address rZ')]
	for idx, val in enumerate(data):
		test_vector_table.append( [ 0, 0, 0, 0, idx, val ] )
		test_vector_table.append( [ idx, val, 0, 0, 0, 0 ] )		
	return test_vector_table


def test_rw( dump_vcd ):
	run_test_vector_sim( RegFile(dtype=16,nregs=16), [
		('rX_address  rX* rY_address  rY* rZ_address  rZ'),
		[       0x0, 0x0,       0x0, 0x0,       0x0, 0x0],
		[       0x0, 0x0,       0x0, 0x0,       0x0, 0xF],
		[       0x0, 0x0,       0x0, 0x0,       0x1, 0xF],
		[       0x1, 0xF,       0x0, 0x0,       0x2, 0xE],
		[       0x0, 0x0,       0x2, 0xE,       0x3, 0xD],
		[       0x3, 0xD,       0x0, 0x0,       0x4, 0xC],
		[       0x0, 0x0,       0x4, 0xC,       0x5, 0xB],
		[       0x5, 0xB,       0x0, 0x0,       0x6, 0xA],
		[       0x0, 0x0,       0x6, 0xA,       0x7, 0x9],
		[       0x7, 0x9,       0x0, 0x0,       0x8, 0x8],
		[       0x0, 0x0,       0x8, 0x8,       0x9, 0x7],
		[       0x9, 0x7,       0x0, 0x0,       0xA, 0x6],
		[       0x0, 0x0,       0xA, 0x6,       0xB, 0x5],
		[       0xB, 0x5,       0x0, 0x0,       0xC, 0x4],
		[       0x0, 0x0,       0xC, 0x4,       0xD, 0x3],
		[       0xD, 0x3,       0x0, 0x0,       0xE, 0x2],
		[       0x0, 0x0,       0xE, 0x2,       0xF, 0x1],
		[       0xF, 0x1,       0x0, 0x0,       0x0, 0x0],
	], dump_vcd)

def test_rw_sequental( dump_vcd ):
	data = gen_data(16,16)
	test_vector_table = gen_vector_table(data)
	print test_vector_table
	run_test_vector_sim( RegFile(dtype=Bits(16),nregs=16), test_vector_table, dump_vcd )		
